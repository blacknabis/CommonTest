# 타워밸런스 고도화 계획 (2026-02-15)

## 0. 문서 목적
- 본 문서는 `TowerConfig.Levels` 중심으로 타워 밸런스를 고정하고, fallback 의존도를 줄이기 위한 실행 계획이다.
- 참고 근거:
  - `문서/진행/타워밸런스_현황표_2026_02_15.md`
  - NotebookLM `킹덤러쉬` 노트북 (`778e7a86-d054-4560-95de-b7378c2a11d3`) 질의 결과

---

## 1. 설계 원칙 (NotebookLM 반영)
1. 역할 분리:
   - `Archer`: 대공/연사/범용 단일 딜
   - `Barracks`: 저지(시간 벌기)/길목 제어
   - `Mage`: 고방어(물리 방어 높은 적) 카운터
   - `Artillery`: 군중 제어(광역 압축 피해)
2. 경제 의사결정:
   - 초반 1~3웨이브는 매 웨이브 종료 시 `신규 건설 vs 업그레이드` 선택지가 유지되어야 한다.
3. 비용 곡선:
   - Lv3 업그레이드 누적 비용은 Lv1 건설 비용의 약 2.0~2.5배 구간을 기준으로 설정한다.
4. 편중 방지:
   - 특정 타워 한 종류만으로 해결되는 상황을 KPI로 감시하고, 웨이브 조합/수치를 함께 조정한다.

---

## 2. 범위 정의

### In Scope
- `Assets/Resources/Data/TowerConfigs/*.asset` 4종(Archer/Barracks/Mage/Artillery) 레벨 데이터 확정
- `TowerManager`의 비용/스탯 참조가 `Levels[]` 기준으로 일관 동작하는지 점검
- 3웨이브 기준 1차 밸런스 검증 + KPI 로그 확인

### Out of Scope (이번 단계 제외)
- 신규 타워 타입 추가
- 포병 스플래시 로직 구조 개편(기능 추가는 별도 태스크)
- 병영 병사 HP/개별 리스폰 시스템 대규모 확장

---

## 3. 현재 문제
1. 자산값 미분화:
   - 현재 TowerConfig 자산은 타입/레벨별 값이 충분히 분화되지 않은 상태.
2. fallback 영향 과대:
   - `TowerManager.PopulateDefaultData`가 실질 밸런스를 결정하는 상황 발생.
3. 역할 체감 약함:
   - 일부 구간에서 타워별 카운터 체감이 약해 전략 다양성이 떨어질 수 있음.

### 핵심 변경폭 (fallback → 목표)
| 타워 | 항목 | 현재(fallback) | 목표 | 의도 |
|---|---|---:|---:|---|
| Archer | Lv1 Dmg | 34 | 10 | DPS 과잉 억제, 레벨 성장 가치 부여 |
| Mage | Lv1 CD | 1.2s | 1.5s | 단발 고데미지 체감 강화 |
| Artillery | Lv1 CD | 0.75s | 2.5s | 포격 리듬 차별화 |
| Barracks | Lv1 Dmg | 5 | 4 | 저지 역할 강조 (딜러 아님) |

---

## 4. 목표 수치 (초안)

### Archer (Physical, CanTargetAir=True)
| Lv | Cost | Damage | Cooldown | Range | VisualScale |
|---:|---:|---:|---:|---:|---:|
| 1 | 70 | 10 | 0.8 | 2.2 | 0.65 |
| 2 | 110 | 20 | 0.7 | 2.4 | 0.75 |
| 3 | 160 | 35 | 0.6 | 2.6 | 0.85 |

### Barracks (Physical, CanTargetAir=False)
| Lv | Cost | Damage | Cooldown | Range | SquadSize | RallyRange | VisualScale |
|---:|---:|---:|---:|---:|---:|---:|---:|
| 1 | 70 | 4 | 1.0 | 1.6 | 3 | 3.5 | 0.65 |
| 2 | 110 | 8 | 1.0 | 1.7 | 3 | 3.8 | 0.75 |
| 3 | 160 | 12 | 0.9 | 1.8 | 3 | 4.0 | 0.85 |

### Mage (Magic, CanTargetAir=True)
| Lv | Cost | Damage | Cooldown | Range | VisualScale |
|---:|---:|---:|---:|---:|---:|
| 1 | 100 | 30 | 1.5 | 2.0 | 0.65 |
| 2 | 160 | 60 | 1.4 | 2.1 | 0.75 |
| 3 | 240 | 100 | 1.3 | 2.2 | 0.85 |

### Artillery (Physical, HalfPhysicalArmorPenetration=True, CanTargetAir=False)
| Lv | Cost | Damage | Cooldown | Range | VisualScale |
|---:|---:|---:|---:|---:|---:|
| 1 | 125 | 20 | 2.5 | 2.4 | 0.65 |
| 2 | 220 | 40 | 2.4 | 2.5 | 0.75 |
| 3 | 320 | 70 | 2.3 | 2.6 | 0.85 |

### Lv3 비교 요약
| 타워 | Lv3 DPS | 누적 비용 | DPS/Gold | 비고 |
|---|---:|---:|---:|---|
| Archer | 58.3 | 340G | 0.171 | 가성비 최고 |
| Barracks | 13.3 | 340G | 0.039 | DPS 외 저지 가치 |
| Mage | 76.9 | 500G | 0.154 | 방어 관통 프리미엄 |
| Artillery | 30.4 | 665G | 0.046 | 스플래시 구현 시 2~4배 상승 기대 |

---

## 5. 실행 계획 (작업 순서)

### 단계 A. 자산 입력
1. `Archer.asset`, `Barracks.asset`, `Mage.asset`, `Artillery.asset`에 `Levels[3]` 입력
2. 각 자산의 `TowerType`, `DamageType`, `CanTargetAir`, `BarracksData`를 타입별로 고정
3. `VisualScale`/`SpriteOverride` 기본값 입력

### 단계 B. 코드 정합성 점검
1. 빌드/업그레이드 비용 참조가 `Levels[n].Cost`만 사용하는지 확인
2. `MaxLevel = Levels.Length` 동작 확인
3. fallback은 `Levels` 누락 시에만 동작하는지 확인

### 단계 C. 플레이 검증
1. 3웨이브 플레이(조기호출 1회 포함)
2. 다음 항목 점검:
   - 웨이브 종료 후 투자 선택지 유지 여부
   - 타워별 역할 체감(카운터 대상 처리)
   - 누수/생존/골드 흐름 안정성
3. 경제 기준선 (초기 100G, 처치 5G/마리, 8~12마리/웨이브 가정):
   - W1 종료 ~70G → Archer/Barracks 건설 가능
   - W2 종료 ~110G → Lv2 업글 또는 신규 건설
   - W3 종료 ~150G → Mage 건설 또는 기존 Lv2

### 단계 D. KPI 기반 조정
1. 아래 KPI 로그 확인 후 2차 수치 조정
2. 조정 후 동일 시나리오 재검증

---

## 6. KPI 기준
- `WaveClearTime`
- `LifeLostPerWave`
- `GoldIncomePerWave` 또는 `netGoldDelta`
- `TowerBuildRateByType`
- `EnemyLeakCountByType`
- `EarlyCallUsageRate`

초기 판정선:
- 3웨이브 테스트에서 특정 타워 빌드율이 70% 초과로 지속되면 편중으로 판단
- 조기호출 사용 시 클리어 시간 단축은 허용, 생존/누수 급락은 비허용

---

## 7. DoD (완료 기준)
- [ ] 4개 타워 자산이 레벨 데이터로 분리 저장됨
- [ ] 업그레이드 비용/스탯이 자산값과 일치
- [ ] MaxLevel 도달 시 업그레이드 비활성 정상
- [ ] fallback이 자산 누락 시에만 동작
- [ ] KPI 기준 편중 완화 확인

---

## 8. 리스크 및 대응
1. 자산 직렬화 누락:
   - 대응: 저장 후 Play 1회, Inspector에서 `Levels` 유지 확인
2. 초반 경제 붕괴(과잉/부족):
   - 대응: 초기 골드/웨이브 보상 미세 조정
3. 포병 광역 체감 부족:
   - 대응: 스플래시 확장 전 임시 수치 보정 또는 가격 완충
4. 병영 체감 부족:
   - 대응: 현재는 저지 중심으로 유지, 병사 HP/리스폰은 별도 기능 태스크로 분리

---

## 9. 롤백 기준
- 아래 중 하나라도 발생하면 이전 자산값으로 롤백 후 재조정:
1. 웨이브2 이전 연속 실패율이 과도하게 상승 (3회 연속 테스트에서 W2 전 패배)
2. 단일 타워 빌드율 80% 이상으로 기존 fallback보다 편중 심화
3. 조기호출 사용 시 `LifeLostPerWave`가 미사용 대비 2배 이상 증가

---

## 10. 즉시 실행 항목
1. TowerConfig 4종 자산 입력
2. 3웨이브 기준 검증
3. KPI 로그 수집
4. 2차 수치 조정
5. 문서 동기화 (`task.md`, `작업상세로그`, `게임씬_구현명세서`)

---

## 11. 부록 A - TowerConfig 자산 입력 체크리스트 (실무용)

대상 파일:
- `Assets/Resources/Data/TowerConfigs/Archer.asset`
- `Assets/Resources/Data/TowerConfigs/Barracks.asset`
- `Assets/Resources/Data/TowerConfigs/Mage.asset`
- `Assets/Resources/Data/TowerConfigs/Artillery.asset`

공통 입력 순서(각 asset 반복):
1. `TowerId`를 자산명과 동일하게 정리 (`Archer`, `Barracks`, `Mage`, `Artillery`)
2. `TowerType`를 자산 타입과 동일하게 설정
3. `DamageType`, `HalfPhysicalArmorPenetration`, `CanTargetAir` 설정
4. `Levels` 배열 크기를 `3`으로 확정
5. Lv1~Lv3의 `Cost`, `Damage`, `Cooldown`, `Range`, `VisualScale` 입력
6. `SpriteOverride`는 현재 없으면 `None` 유지
7. `Barracks`만 `BarracksData.SquadSize`, `BarracksData.RallyRange` 입력
8. 저장 후 Play 1회 -> 값 유지 여부 재확인

검증 포인트:
- `TowerManager.Configure()`에서 로드한 asset이 `Levels.Length > 0`이면 fallback 미사용
- `TryUpgradeTower()`에서 다음 레벨 비용이 `Levels[next].Cost`와 일치
- `TowerRuntime.MaxLevel == Levels.Length` 일치

실수 방지 체크:
- [ ] `TowerType` 불일치 없음
- [ ] `CanTargetAir` 오설정 없음 (`Barracks`, `Artillery`는 기본 `False`)
- [ ] `Artillery`의 `HalfPhysicalArmorPenetration=True` 확인
- [ ] `BarracksData`가 Barracks 외 asset에 남아있지 않음

---

## 12. 부록 B - 3웨이브 KPI 기록 템플릿 (복붙용)

아래 표를 `문서/진행/작업상세로그_2026_02_15.md`에 회차별로 누적 기록:

| 회차 | 난이도 | 빌드 순서(타워/타이밍) | W1 clearTime | W2 clearTime | W3 clearTime | lifeLost 합계 | netGoldDelta 합계 | towerBuildRateByType | earlyCallUsageRate | 결과(승/패) | 메모 |
|---:|---|---|---:|---:|---:|---:|---:|---|---:|---|---|
| 1 | Normal | Archer@W1, Mage@W2 ... |  |  |  |  |  |  |  |  |  |
| 2 | Normal |  |  |  |  |  |  |  |  |  |  |
| 3 | Veteran |  |  |  |  |  |  |  |  |  |  |

판정 규칙(기록 시 함께 체크):
- [ ] 특정 타워 빌드율 70% 초과 지속 여부
- [ ] 조기호출 사용 시 생존 안정성 저하 여부
- [ ] 웨이브 종료 후 `신규 건설 vs 업글` 선택지 유지 여부
- [ ] 누수 발생 시 복구 가능 경제 흐름 여부

---

## 13. 부록 C - 조정 우선순위 규칙 (수치 튜닝 가드레일)

한 번의 패치에서 한 축만 조정:
1. 1순위: `Cost`
2. 2순위: `Cooldown`
3. 3순위: `Damage`
4. 4순위: `Range`

권장 조정폭:
- Cost: ±10~15%
- Cooldown: ±0.1~0.2s
- Damage: ±10~20%
- Range: ±0.1~0.2

이유:
- 다축 동시 조정은 원인 추적이 어려워 KPI 해석이 불가능해진다.
- 단축 조정 후 3~5판 로그를 쌓고 다음 축으로 이동한다.
