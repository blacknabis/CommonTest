# 작업 상세 로그 (2026-02-22)

## 작업 개요
- **작업명**: 오브젝트 클릭 정보 및 HP 게이지 구현 계획 보완
- **담당**: Antigravity
- **상태**: 계획 보완 완료 (Phase 1 착수 준비)

## 상세 내용
### 1. 구현 계획서 보완 (문서/진행/오브젝트_클릭정보_체력게이지_구현_계획_2026_02_22.md)
- **시각적 피드백 강화**: Kingdom Rush 스타일의 발밑 선택 서클(Selection Circle) 기획 추가.
- **UI 정보 항목 구체화**:
    - 적: Armor Type, Speed, Reward Gold
    - 아군: Damage, Armor, Respawn Timer
    - 타워: Level, Damage, Range, Cost/Refund
- **HP 바 정책 수립**: 항상 노출이 아닌, 대미지를 입은 유닛(HP < 100%)에 대해서만 노출하도록 하여 UI 가시성 확보.
- **Snappy UX**: 정보 패널 오픈 시 Scale Pop-up 애니메이션 정의.

### 2. 프로젝트 관리 문서 동기화
- `task.md` 내 신규 메인 트랙 상세화 및 페이즈 분리.

## 다음 작업
- Phase 1 시작: `ISelectableTarget` 인터페이스 정의 및 `SelectionController` 기초 구현.

---

## [2026-02-22 14:14:07] 후속 수정 로그 (문서 리뷰 기반)

### 이슈
- 실기동 시 오브젝트 클릭 선택 및 정보 표시가 기대와 다르게 동작.

### 원인 확인
- `SelectionController`가 `Physics2D.OverlapCircleAll`을 사용하지만, 런타임 생성 대상(적/타워/병사/영웅) 다수에 `Collider2D`가 없어서 클릭 미탐지.
- 타워는 `TowerRuntime : ISelectableTarget`이나 `MonoBehaviour`가 아니라 `GetComponentInParent<ISelectableTarget>()` 경로에 걸리지 않음.
- `SelectionInfoPanel`의 `_txtHp`는 자동 바인딩 로직이 누락되어 씬 바인딩이 빠지면 HP 텍스트가 비어 보일 수 있음.

### 조치
- `SpawnManager`: 적 생성 시 `CircleCollider2D` 추가.
- `TowerManager`: 타워/배럭병사 생성 시 `CircleCollider2D` 추가, `TowerSelectableProxy : MonoBehaviour, ISelectableTarget` 추가.
- `HeroController`: 시각 초기화 시 영웅 선택용 `CircleCollider2D` 보강.
- `SelectionController`: LayerMask 미설정(0) 또는 마스크 미매치 시 all-layer fallback으로 재탐색.
- `SelectionInfoPanel`, `WorldHpBar`, `WorldHpBarManager`: `Common.Extensions` 기반 `IsNull()/IsNotNull()`로 null 체크 통일 및 `_txtHp` 자동 바인딩 보강.

### 상태
- 코드 반영 완료, 빌드/실기동 검증 진행 예정.

### 검증 결과
- `dotnet build Assembly-CSharp.csproj -v minimal` 수행
- 결과: 오류 0, 기존 프로젝트 경고만 유지

---

## [2026-02-22 14:18:37] 추가 이슈 대응 로그

### 이슈
- 게임 화면 중앙에 흰 사각형이 보이고, 캐릭터 클릭 선택이 동작하지 않음.

### 원인
- `GameView.prefab` 내 `SelectionInfoPanel` 계층의 placeholder `Image`가 중앙에 활성 상태로 존재.
- 해당 `Image`와 텍스트들이 `raycastTarget=true`라서 입력이 UI로 인식되고 월드 선택이 차단됨.

### 조치
- `SelectionInfoPanel`에 `DisablePlaceholderImagesAndRaycasts()` 추가:
  - 스프라이트 없는 `Image`는 투명화.
  - `Image`, `TextMeshProUGUI`, `Slider.targetGraphic` raycast 차단.

### 검증
- `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0.

---

## [2026-02-22 14:23:23] 추가 이슈 대응 로그 2

### 이슈
- `BarracksSoldier_1_3` 클릭 포함 대부분 오브젝트가 선택되지 않음.

### 원인
- 선택 입력의 핵심인 `SelectionController`가 씬 시작 시 생성되지 않아 이벤트 체인이 시작되지 않음.

### 조치
- `GameScene`에 `EnsureSelectionSystems()` 추가:
  - `SelectionController`/`SelectionCircleVisual`를 `FindFirstObjectByType`로 확인하고 없으면 자동 생성.
  - 생성 후 `SelectionController.SetCircleVisual()`로 연결.
- `SelectionCircleVisual`에 기본 스프라이트 자동 로드 보강:
  - `Resources.Load<Sprite>(\"UI/Sprites/Common/SelectionCircle\")`.

### 검증
- `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0.

---

## [2026-02-22 15:29:23] 계획 문서화

### 요청
- Selection/HP바 관련 현재 논의 내용을 실행 계획으로 문서화.

### 산출물
- `문서/진행/SelectionSystem_프리팹전환_및_HP바_안정화_계획_2026_02_22.md`

### 핵심 계획
- `SelectionSystem.prefab` 신규 생성 후 `GameScene`에서 프리팹 우선 로드.
- `WorldHpBar.prefab` 컴포넌트/바인딩 정합성 고정.
- HP바 머리 위 위치/좌측 고정 감소 UX 최종 튜닝.
- 수동 회귀 + 빌드 오류 0 기준으로 마감.

---

## [2026-02-22 15:49:31] 계획서 보완 + 문서 동기화

### 요청
- SelectionSystem/HP바 계획서 보완 및 관련 문서 동시 반영.

### 보완 내용
- 계획서에 실행 상태 매트릭스, 문서 동기화 규칙, 우선순위 재정렬, 리스크 플레이북 추가.
- `task.md`에 Rev.2 동기화 Phase 및 기술 부채 정리 Phase 추가.
- HP바 좌측 고정 감소 적용 상태를 `task.md` 체크 항목에 반영.

---

## [2026-02-22 16:52:35] 후속 작업 진행

### 요청
- 전체 커밋 후 이어서 구현 진행.

### 반영
- 커밋 완료: `996d261`
- `SelectionSystem` 프리팹 우선 로드 경로 추가(`Resources/UI/SelectionSystem`), 실패 시 런타임 fallback 유지.
- 타워/슬롯 클릭 시 `SelectionController` 동시 반응을 프레임 단위 억제로 차단(방안 B).

### 검증
- `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0.
