# Codex IDE 인수인계서 - 오디오 옵션창 (2026-02-19)

## 0) 목적
- 현재 브랜치/워크스페이스에서 진행한 **오디오 옵션창 1차 구현**을 Codex IDE에서 이어서 마무리하기 위한 인수인계 문서.

## 1) 현재 완료 상태 (요약)
- 오디오 설정 키/서비스 구현 완료
- 월드맵 오디오 옵션 팝업 오픈 경로 구현 완료
- 오디오 설정 자동 회귀 러너(UniTask) 구현 및 **통과(success=11, fail=0)**
- 문서 동기화(task/log) 완료
- Unity MCP 로컬 설정 반영 완료(`.kilocode/mcp.json`)

## 2) 핵심 변경 파일
### 코드
1. `Assets/Scripts/Kingdom/Audio/AudioSettingsKeys.cs`
   - `Kingdom.Audio.*` 키/기본값 상수
2. `Assets/Scripts/Kingdom/Audio/AudioSettingsService.cs`
   - Load/Save/ApplyToAudioHelper
   - 레거시 키(`Common_BGMVolume`, `Common_SFXVolume`) 호환
3. `Assets/Scripts/Kingdom/UI/AudioOptionsPopup.cs`
   - 슬라이더/뮤트 토글/라벨 바인딩
   - SFX 샘플 재생 디바운스
4. `Assets/Scripts/Kingdom/UI/WorldMapView.cs`
   - `OpenAudioOptionsPopup()`
   - `AudioOptionsPopupResourcePath = "UI/WorldMap/AudioOptionsPopup"`
   - 프리팹 미존재 시 폴백 팝업 생성
5. `Assets/Scripts/Kingdom/KingdomAppManager.cs`
   - 회귀 러너 전반 코루틴 -> UniTask 전환
   - `RunAudioSettingsRegressionAsync()` 추가
6. `Assets/Scripts/Kingdom/Editor/AudioOptionsPopupPrefabBuilder.cs`
   - 메뉴: `Tools/Kingdom/Build AudioOptionsPopup Prefab`
   - 생성 경로: `Assets/Resources/UI/WorldMap/AudioOptionsPopup.prefab`

### 문서
1. `문서/진행/task.md`
2. `문서/진행/작업상세로그_2026_02_19.md`
3. `문서/진행/환경설정_오디오옵션창_작업계획_2026_02_19.md`

## 3) 확인된 실행 결과
- 자동 회귀 러너 로그:
  - `[KingdomAppManager] Audio settings regression finished. success=11, fail=0, testBgm=0.23, testSfx=0.67, testBgmMuted=True, testSfxMuted=False`
- 의미:
  - PlayerPrefs 저장값 검증 통과
  - AudioHelper 런타임 반영 검증 통과
  - 씬 왕복 후 유지 검증 통과
  - 테스트 후 원복 동작 정상

## 4) 현재 남은 작업 (Codex IDE에서 우선 처리)
1. **프리팹 실제 생성 확인** *(완료)*
   - Unity 에디터 메뉴 `Tools/Kingdom/Build AudioOptionsPopup Prefab` 실행 성공
   - 파일 생성 확인: `Assets/Resources/UI/WorldMap/AudioOptionsPopup.prefab`
2. **프리팹 로드 경로 검증** *(부분 완료)*
   - 월드맵에서 오디오 옵션 열기
   - 코드 상수 및 프리팹 리소스 존재 확인 완료 (`UI/WorldMap/AudioOptionsPopup`)
   - PlayMode에서 폴백 미사용 여부 최종 확인 필요
3. **월드맵 버튼 슬롯 검증** *(코드 보강 완료)*
   - `WorldMapView`의 `btnAudioOptions` 슬롯이 비어 있어도 런타임 자동 복구되도록 보강됨
   - 최종적으로 프리팹/씬 슬롯 직렬화 연결은 에디터에서 확인 권장
4. **최종 수동 QA**
   - BGM/SFX 슬라이더 즉시 반영
   - Mute 토글 반영
   - 앱 재실행 복원
   - 월드맵↔게임 씬 왕복 시 값 일관성

## 5) 주의사항
- 현재 프로젝트가 열려 있으면 배치모드 Unity 실행은 실패함(동일 프로젝트 다중 실행 불가).
- 따라서 프리팹 빌드는 **열려 있는 Unity Editor 내부 메뉴 실행**이 우선.
- 사용자 요청으로 코드 주석은 충분히 보강된 상태.

## 6) 권장 마무리 커밋 단위
1. `feat(audio): add AudioOptionsPopup prefab builder and resources path integration`
2. `chore(audio): verify prefab load path and finalize QA docs`

## 7) 빠른 체크리스트
- [x] `AudioOptionsPopup.prefab` 생성됨
- [ ] 월드맵에서 옵션 팝업 정상 오픈
- [x] `btnAudioOptions` 슬롯 누락 시 런타임 자동 복구 코드 반영
- [ ] 슬라이더/뮤트 동작 정상
- [ ] 재실행 복원 정상
- [ ] 문서(task/log) 최종 갱신
