# 작업상세로그

## [2026-02-22 13:27:39] 작업 기록
- AISpriteProcessor Run All에서 배럭 4액션 추론 fallback 추가
- BarracksSoldierRuntime에서 공격 상태 유지시간을 attack 클립 길이 기준으로 보정
- null 비교를 IsNull/IsNotNull 확장 스타일로 일부 반영
- 배럭 병사 폴백 비주얼(어두워짐/찌그러짐) 제거

## [2026-02-22 13:31:58] 작업 기록
- 이슈: 몬스터 잔존 상태에서 VICTORY 팝업 조기 노출
- 원인: GameStateController.WaveRunning에서 waveDuration 경과만으로 Result 상태 자동 전이
- 조치: useLegacyWaveDurationAutoComplete(기본 false) 가드 추가, 기본 흐름을 WaveManager 완료 조건 기반으로 고정
- 검증: dotnet build Assembly-CSharp.csproj 오류 0

## [2026-02-22 13:42:05] 작업 기록
- 요청: 오브젝트 클릭 정보 + 체력 게이지 기능 플랜 수립
- 산출물: 문서/진행/오브젝트_클릭정보_체력게이지_구현_계획_2026_02_22.md
- task.md 신규 트랙 체크리스트 추가

## [2026-02-22 14:14:07] 작업 기록
- 요청: 오브젝트 클릭 정보/HP게이지 구현 문서 리뷰 후 이어서 수정 진행
- 결함 원인 정리:
  - 선택 탐지가 `Physics2D.OverlapCircleAll` 기반인데 런타임 생성 오브젝트 다수에 `Collider2D` 부재
  - 타워는 `TowerRuntime`이 `MonoBehaviour`가 아니어서 `GetComponentInParent<ISelectableTarget>()` 탐지 불가
  - `SelectionInfoPanel`의 `_txtHp` 자동 바인딩 누락
- 코드 조치:
  - `SpawnManager`: 적 생성 시 `CircleCollider2D(isTrigger, radius=0.35)` 추가
  - `TowerManager`: 타워/배럭 병사 생성 시 `CircleCollider2D` 추가, `TowerSelectableProxy` 도입
  - `HeroController`: 영웅 시각 초기화 시 `CircleCollider2D` 보강
  - `SelectionController`: LayerMask 미설정(0) 및 마스크 미매치 시 all-layer fallback 추가
  - `SelectionInfoPanel`, `WorldHpBar`, `WorldHpBarManager`: `IsNull/IsNotNull` 스타일로 null 체크 통일
- 문서 동기화:
  - `문서/진행/task.md` 진행 메모 추가
- 빌드 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0 확인 (기존 경고 유지)

## [2026-02-22 14:18:37] 작업 기록
- 사용자 제보: 게임 중앙 흰 사각형 노출 + 캐릭터 클릭 미반응
- 원인 확인:
  - `SelectionInfoPanel` 루트/PanelRoot에 `Image(sprite=null, color=white, raycastTarget=true)`가 있어 중앙에 흰 박스로 노출
  - 해당 UI Raycast가 `EventSystem.current.IsPointerOverGameObject()`에 걸려 월드 선택 입력을 차단
- 조치:
  - `SelectionInfoPanel` 시작 시 `DisablePlaceholderImagesAndRaycasts()` 추가
  - 스프라이트 없는 `Image`는 투명 처리 + 모든 `Image/TMP` raycastTarget 비활성화
  - Slider targetGraphic raycast도 비활성화
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:23:23] 작업 기록
- 사용자 제보: `BarracksSoldier_1_3` 포함 오브젝트 클릭 반응 없음
- 원인 확인:
  - `SelectionController`가 `GameScene`에서 생성/배치되지 않아 선택 입력 파이프라인 자체가 미동작
- 조치:
  - `GameScene.OnStartScene()`에 `EnsureSelectionSystems()` 호출 추가
  - `SelectionController` 및 `SelectionCircleVisual` 미존재 시 런타임 자동 생성 후 바인딩
  - `SelectionCircleVisual`에서 기본 스프라이트 경로(`UI/Sprites/Common/SelectionCircle`) 자동 로드
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:28:26] 작업 기록
- 사용자 제보: 선택 후 중앙에 큰 흰 원 + 검은 배경 패널 노출
- 조치:
  - `SelectionCircleVisual` 스케일 로직을 콜라이더 크기 기반으로 재산정 (과대 원 방지)
  - `SelectionCircleVisual` z 위치 조정(배경 위/유닛 아래)
  - `SelectionInfoPanel`의 placeholder `Image`를 강제 비활성화(`enabled=false`, alpha=0) 처리
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:34:09] 작업 기록
- 요청: HP바 항상 표기
- 조치:
  - `WorldHpBar.Update()`에서 `CanvasGroup.alpha`를 항상 `1f`로 고정
  - 기존 `HP<100%` 조건부 노출 정책 제거
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:37:51] 작업 기록
- 사용자 제보: HP바 여전히 미표시
- 원인 확인:
  - `WorldHpBarManager`가 씬/프리팹 어디에도 존재하지 않아 `TrackTarget()` 호출이 전부 무시됨
- 조치:
  - `GameScene` 시작 시 `EnsureWorldHpBarSystem()` 추가
  - `WorldHpBarManager` 런타임 자동 생성
  - `Resources/UI/WorldHpBar` 프리팹 자동 로드/주입
  - `WorldHpBarManager.ConfigureRuntime()` 추가(프리팹/루트/풀 사이즈 런타임 구성)
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:43:51] 작업 기록
- 사용자 제보: `WorldHpBarManager.GetAvailableBar()` NullReferenceException
- 원인:
  - HP바 풀(`_pool`)에 null 항목이 포함된 상태에서 `bar.gameObject` 접근
- 조치:
  - `CreateNewBar()`에서 `WorldHpBar` 컴포넌트 누락 인스턴스는 풀에 넣지 않고 폐기
  - `GetAvailableBar()`에서 null 풀 항목 정리 후 사용
  - `UntrackTarget()`에서 bar null 안전 처리
  - `Awake()` 싱글톤 중복 가드 유지
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:49:42] 작업 기록
- 사용자 제보: `[WorldHpBarManager] WorldHpBar component missing on prefab instance.`
- 원인:
  - `UI/WorldHpBar` 프리팹 인스턴스 루트에 `WorldHpBar` 컴포넌트가 없는 상태
- 조치:
  - `WorldHpBarManager.CreateNewBar()`에서 컴포넌트 누락 시 런타임 자동 추가
  - `WorldHpBar`에서 `_fillRenderer` 자동 탐색 로직 추가(`Fill` 이름 우선, 없으면 자식 SpriteRenderer fallback)
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 14:54:19] 작업 기록
- 사용자 제보: HP바가 오브젝트 정중앙에 표시됨
- 조치:
  - `WorldHpBar.UpdatePosition()`을 고정 위치(`target.Position + offset`)에서
    콜라이더/스프라이트 bounds 기반 머리 위 앵커 계산으로 변경
  - 앵커 계산 우선순위: `Collider2D.max.y` -> `SpriteRenderer.max.y` -> fallback(`target.Position`)
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 15:01:44] 작업 기록
- 사용자 요청:
  - 체력 게이지가 양쪽에서 줄어듦 -> 좌측 고정으로 변경 필요
  - 체력 게이지가 캐릭터보다 너무 높음 -> 위치 하향 필요
- 조치:
  - `WorldHpBar.UpdateHp()`에서 Fill 스케일 축소 시 localPosition X를 함께 보정하여 좌측 고정 감소 구현
  - `WorldHpBar` 기본 `_offset.y`를 0.08로 하향
  - 기존 오프셋이 큰 경우(>0.3) 런타임 안전값으로 보정
  - 머리 위 앵커 패딩 값을 축소(`extra` clamp 하향)하여 과도한 상단 위치 완화
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 15:29:23] 작업 기록
- 요청: 현재 논의 내용 기준으로 실행 계획 문서화
- 산출물:
  - `문서/진행/SelectionSystem_프리팹전환_및_HP바_안정화_계획_2026_02_22.md`
- 반영 내용:
  - SelectionSystem 프리팹 전환(생성 누락 리스크 제거)
  - GameScene 부트스트랩 정리(프리팹 우선 + fallback)
  - WorldHpBar 프리팹 정합성 고정
  - HP바/SelectionCircle UX 튜닝 및 검증 단계 정의
- 프로젝트 문서 동기화:
  - `문서/진행/task.md` 신규 메인 트랙 추가

## [2026-02-22 15:49:31] 작업 기록
- 요청: `SelectionSystem_프리팹전환_및_HP바_안정화_계획_2026_02_22.md` 보완 + 다른 문서 동시 반영
- 계획서 보완:
  - 실행 상태 매트릭스(완료/진행중/미완료) 추가
  - 문서 동기화 반영 지침(대상 문서 + 규칙) 추가
  - 우선순위 재정렬된 다음 실행 액션 추가
  - 리스크 대응 플레이북(증상-확인-조치) 추가
- 연동 문서 반영:
  - `task.md`에 Phase 0(Rev.2 동기화), Phase 4.5(기술 부채) 추가
  - HP바 좌측 고정 감소 항목 완료로 상태 반영

## [2026-02-22 16:52:35] 작업 기록
- 요청: 전체 커밋 후 작업 계속 진행
- 커밋:
  - `996d261` (`feat: stabilize selection/hp UI pipeline and sync docs`)
- 추가 코드 조치:
  - `GameScene.EnsureSelectionSystems()`를 `SelectionSystem` 프리팹 우선 로드(`Resources/UI/SelectionSystem`)로 보강
  - 프리팹 로드 실패/컴포넌트 누락 시 기존 런타임 생성 fallback 유지
  - `SelectionController.SuppressSelectionForCurrentFrame()` 추가
  - `GameScene.Update()`의 타워/슬롯 클릭 처리 시 해당 프레임 Selection 입력 억제로 클릭 충돌(방안 B) 방지
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0
- 문서 동기화:
  - `task.md` Phase 2 완료 체크, Phase 4.5(클릭 충돌 방지) 완료 체크

## [2026-02-22 17:07:40] 작업 기록
- 요청: 커밋 이후 구현 계속 진행 (SelectionSystem 프리팹 실자산화)
- 코드 조치:
  - `Assets/Scripts/Kingdom/Editor/SelectionSystemPrefabBuilder.cs` 추가
    - 메뉴: `Tools/Kingdom/Build SelectionSystem Prefab`
    - 결과: `Assets/Resources/UI/SelectionSystem.prefab` 생성
    - 구성: `SelectionController` + `SelectionCircleVisual` + `_circleVisual` 직렬화 참조
  - `Assets/Scripts/Kingdom/Editor/WorldHpBarPrefabBuilder.cs` 추가
    - 메뉴: `Tools/Kingdom/Build WorldHpBar Prefab`
    - 결과: `Assets/Resources/UI/WorldHpBar.prefab` 재생성
    - 구성: 루트 `WorldHpBar` 컴포넌트 + `Fill` SpriteRenderer 직렬화 바인딩
  - `Assets/Scripts/Kingdom/Game/UI/WorldHpBar.cs`
    - `CanvasGroup` 의존 제거(생성/alpha 갱신 제거)
- Unity 실행 반영:
  - 메뉴 실행 로그 확인
    - `[SelectionSystemPrefabBuilder] Prefab generated: Assets/Resources/UI/SelectionSystem.prefab`
    - `[WorldHpBarPrefabBuilder] Prefab generated: Assets/Resources/UI/WorldHpBar.prefab`
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0 (기존 경고 유지)
- 문서 동기화:
  - `task.md` Phase 1/3/4.5/5 상태 업데이트

## [2026-02-22 17:12:58] 작업 기록
- 요청: 후속 진행(회귀 안정성 확인)
- 조치:
  - Unity Play Mode 진입 후 `Tools/Kingdom/Run Barracks Melee Smoke Regression` 실행
  - 종료 로그 확인:
    - `[KingdomAppManager] Barracks melee smoke regression finished. success=10, fail=0, ...`
  - Play Mode 종료
- 판단:
  - 자동 스모크 기준 배럭 전투 루프 회귀는 통과
  - 수동 클릭 선택/HP바 시각 검증은 별도 진행 필요
- 문서 동기화:
  - `task.md` 진행 메모에 자동 회귀 결과 반영

## [2026-02-22 17:52:15] 작업 기록
- 요청: Selection/HP UI 스모크 회귀를 끝까지 통과하도록 보강
- 원인 분석:
  - `SelectionInfoPanel`과 `SelectionCircleVisual`이 런타임 비활성 상태일 수 있어 `FindFirstObjectByType` 기본 탐색에서 누락
  - `SelectionInfoPanel` 프리팹 구조상 HP 텍스트 슬롯이 없어 `_txtHp`가 비어 회귀 검증에서 `hpText=false`
- 코드 조치:
  - `Assets/Scripts/Kingdom/KingdomAppManager.cs`
    - Selection UI 스모크 참조 수집을 `include inactive` 기반으로 보강
    - runtime reference 준비 대기(`WaitForSelectionUiRuntimeRefsAsync`) 추가
    - 적 대상 검증은 웨이브 타이밍 의존으로 경고/옵션 검증으로 전환(없어도 회귀 중단하지 않음)
  - `Assets/Scripts/Kingdom/Game/UI/SelectionInfoPanel.cs`
    - `_txtHp` 미바인딩 시 런타임 HP 라벨(`txtHpRuntime`) 자동 생성
    - 자동 생성 라벨은 `_txtName` 폰트/색상 스타일을 따라가며 raycast 비활성
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0
  - Unity Play Mode: `Tools/Kingdom/Run Selection + HP UI Smoke Regression`
  - 결과 로그:
    - `Selection UI smoke Hero/Soldier/Tower pass=True`
    - `Selection UI smoke regression finished. success=9, fail=0`
- 문서 동기화:
  - `문서/진행/task.md` 17:52 진행 메모 추가

## [2026-02-22 19:17:45] 작업 기록
- 요청: SelectionInfoPanel을 별도 프리팹으로 분리하고 GameView 참조 구조로 전환
- 코드 조치:
  - `Assets/Scripts/Kingdom/UI/GameView.cs`
    - `SelectionInfoPanelResourcePath` 상수 추가 (`UI/SelectionInfoPanel`)
    - `selectionInfoPanel` 필드 추가
    - `Awake()`에서 `EnsureSelectionInfoPanel()` 호출로 프리팹 인스턴스화 연결
    - 레거시 내장 패널 삭제 후 새 프리팹만 사용하도록 정리
    - 프리팹 누락 시 오류 로그 출력(fail-fast)
  - `Assets/Scripts/Kingdom/Game/UI/SelectionInfoPanel.cs`
    - placeholder 이미지 비활성 정책을 `sprite == null`인 경우로 축소 (실제 스프라이트 이미지 유지)
  - `Assets/Scripts/Kingdom/Editor/SelectionInfoPanelPrefabBuilder.cs` 신규 추가
    - 메뉴: `Tools/Kingdom/Build SelectionInfoPanel Prefab`
    - 출력: `Assets/Resources/UI/SelectionInfoPanel.prefab`
    - 빌드 시 `GameView.prefab` 내 내장 `SelectionInfoPanel` 자동 제거
- Unity 에디터 반영:
  - 메뉴 실행 로그 확인:
    - `[SelectionInfoPanelPrefabBuilder] Removed embedded SelectionInfoPanel from GameView. count=1`
    - `[SelectionInfoPanelPrefabBuilder] Prefab generated: Assets/Resources/UI/SelectionInfoPanel.prefab`
  - `Assets/Resources/UI/GameView.prefab`에서 `SelectionInfoPanel` 문자열 미검출 확인
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0
  - Play Mode 회귀:
    - `Tools/Kingdom/Run Selection + HP UI Smoke Regression`
    - 결과: `Selection UI smoke regression finished. success=9, fail=0`
- 문서 동기화:
  - `문서/진행/task.md` 18:00 항목 완료 체크로 업데이트

## [2026-02-22 19:24:16] 작업 기록
- 요청: 정보 패널이 좌측 HUD와 겹치는 위치 수정
- 원인:
  - `SelectionInfoPanel.prefab` 루트 RectTransform이 좌상단 앵커(`x=24, y=-208`)라 `txtTowerInfo` 영역과 충돌
- 조치:
  - `Assets/Scripts/Kingdom/Editor/SelectionInfoPanelPrefabBuilder.cs`
    - 루트 앵커를 우상단으로 변경
    - 기본 위치를 `(-24, -170)`으로 이동
    - 폭을 `220`으로 축소해 우측 사이드 내에 고정
  - 메뉴 실행: `Tools/Kingdom/Build SelectionInfoPanel Prefab`
- 검증:
  - `Tools/Kingdom/Run Selection + HP UI Smoke Regression` 재실행
  - 결과: `success=9, fail=0`, 신규 warning/error 없음
- 문서 동기화:
  - `문서/진행/task.md` 19:24 진행 메모 추가


## [2026-02-22 19:33:40] 작업 기록
- 요청: 병영 병사 클릭 시 DisplayName이 의도와 다르게 보이는 문제 점검
- 확인 결과:
  - 선택 정보 패널은 ISelectableTarget.DisplayName 값을 그대로 표기
  - 병사 런타임에 주입된 표시명 경로는 정상이나, 최근 수정분 null/공백 체크 스타일이 Common.Extensions 규칙과 불일치
- 조치:
  - BarracksSoldierRuntime.DisplayName/Initialize()의 문자열 공백 체크를 IsNullOrWhiteSpace() 확장 메서드로 통일
  - TowerManager 배럭 병사 생성 시 BarracksSoldierConfig.DisplayName 검사도 확장 메서드 방식으로 통일
- 검증:
  - dotnet build Assembly-CSharp.csproj -v minimal 오류 0 (기존 경고만 유지)

## [2026-02-22 20:05:56] 작업 기록
- 요청: 선택 패널 정보에 공격력/방어력 추가
- 조치:
  - Assets/Scripts/Kingdom/Game/ISelectableTarget.cs
    - AttackPower, DefensePower 속성 추가
  - Assets/Scripts/Kingdom/Game/BaseUnit.cs
    - 기본 공격력/방어력 속성(0) 추가
  - Assets/Scripts/Kingdom/Game/EnemyRuntime.cs
    - 공격력: (AttackDamageMin+AttackDamageMax)/2
    - 방어력: 물리 저항 퍼센트(GetResistancePercent(Physical) * 100)
  - Assets/Scripts/Kingdom/Game/HeroController.cs
    - 공격력: 현재 레벨 평균 피해
    - 방어력: 현재 방어 퍼센트(_armorPercent * 100)
  - Assets/Scripts/Kingdom/Game/BarracksSoldierRuntime.cs
    - 공격력: _attackDamage
    - 방어력: 0
  - Assets/Scripts/Kingdom/Game/TowerManager.cs
    - TowerSelectableProxy가 공격력/방어력 전달
    - TowerRuntime 공격력 제공(일반 타워: 현재 레벨 Damage, 배럭: SoldierDamage), 방어력 0
  - Assets/Scripts/Kingdom/Game/UI/SelectionInfoPanel.cs
    - txtCombat 라벨 필드 추가
    - 선택 대상 갱신 시 ATK {값}   DEF {값} 표시
    - 프리팹에 라벨이 없으면 런타임으로 txtCombat 자동 생성
  - Assets/Scripts/Kingdom/Editor/SelectionInfoPanelPrefabBuilder.cs
    - txtCombat 라벨 생성 및 _txtCombat 직렬화 바인딩 추가
- 검증:
  - dotnet build Assembly-CSharp.csproj -v minimal 오류 0 (기존 경고만 유지)


## [2026-02-22 20:07:27] 작업 기록
- 요청 후속 검증: 패널 ATK/DEF 반영 이후 회귀 확인
- 실행:
  - Tools/Kingdom/Build SelectionInfoPanel Prefab
  - Tools/Kingdom/Run Selection + HP UI Smoke Regression
- 결과:
  - Selection UI smoke Hero/Enemy/Soldier/Tower pass=True
  - Selection UI smoke regression finished. success=11, fail=0

## [2026-02-22 20:14:47] 작업 기록
- 요청: 우측 상단 Selection 패널에서 체력/공격/방어를 한 줄이 아닌 여러 줄로 표기
- 조치:
  - `Assets/Scripts/Kingdom/Game/UI/SelectionInfoPanel.cs`
    - HP 라벨을 `HP {current} / {max}` 형식으로 변경
    - 전투 라벨을 `ATK ...\nDEF ...` 멀티라인으로 변경
    - `NormalizeLayoutForCompactSidePanel()` 추가로 우측 사이드 패널 기준 레이아웃 강제 정렬
      - 패널 최소 높이 120
      - HP 라벨/HP 슬라이더/전투 라벨 위치 재배치
  - `Assets/Scripts/Kingdom/Editor/SelectionInfoPanelPrefabBuilder.cs`
    - 기본 프리팹 높이 92 -> 120으로 확장
    - `txtHp`, `hpSlider`, `txtCombat` 기본 좌표/크기 조정(멀티라인 대응)
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0
  - `Tools/Kingdom/Build SelectionInfoPanel Prefab` 실행 로그 확인
  - `Tools/Kingdom/Run Selection + HP UI Smoke Regression` 결과 `success=11, fail=0`

## [2026-02-22 20:24:55] 작업 기록
- 요청: 2줄 표기 시 하단 내용과 겹침 해소 + HP 슬라이더 제거
- 조치:
  - `Assets/Scripts/Kingdom/Game/UI/SelectionInfoPanel.cs`
    - `_hpSlider` 필드/업데이트/레이아웃 로직 제거
    - `txtName`을 최대 2줄(말줄임)로 제한하고, `txtHp`/`txtCombat`를 아래로 재배치
    - 패널 최소 높이를 132로 확장
    - HP 표기를 텍스트(`HP 현재/최대`)만 사용
  - `Assets/Scripts/Kingdom/Editor/SelectionInfoPanelPrefabBuilder.cs`
    - `hpSlider` 생성/직렬화 바인딩 제거
    - 패널/라벨 기본 좌표 재조정(겹침 방지)
  - `Assets/Scripts/Kingdom/KingdomAppManager.cs`
    - Selection UI 스모크에서 슬라이더 검증 제거(텍스트+패널+HP바 기준 유지)
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0
  - `Tools/Kingdom/Build SelectionInfoPanel Prefab` 실행 로그 확인
  - Play Mode 진입 후 `Tools/Kingdom/Run Selection + HP UI Smoke Regression` 결과 `success=9, fail=0`

## [2026-02-22 20:27:33] 작업 기록
- 요청: AISpriteProcessor 메뉴 위치 확인 (스크린샷상 상위 메뉴가 하위 폴더로만 보임)
- 원인:
  - `MenuItem("Tools/Common/AI Sprite Processor")`와
    `MenuItem("Tools/Common/AI Sprite Processor/Run Preset Load Regression")` 조합으로
    상위 항목이 폴더처럼 동작
- 조치:
  - `Assets/Scripts/Kingdom/Editor/AISpriteProcessor.cs`
    - 회귀 메뉴 경로를 `Tools/Common/AI Sprite Processor - Run Preset Load Regression`로 변경
- 결과:
  - `Tools > Common > AI Sprite Processor`에서 창 직접 오픈 가능
  - 회귀 메뉴는 `Tools > Common > AI Sprite Processor - Run Preset Load Regression`로 사용
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 20:42:41] 작업 기록
- 요청: 제거 후보 툴만 우선 삭제
- 삭제 파일:
  - `Assets/Scripts/Kingdom/Editor/AudioOptionsPopupPrefabBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/HeroRoomPopupPrefabBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/SelectionInfoPanelPrefabBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/SelectionSystemPrefabBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/UpgradesPopupPrefabBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/WorldHpBarPrefabBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/KingdomCoreDataBuilder.cs`
  - `Assets/Scripts/Kingdom/Editor/TileGenerator.cs`
  - `Assets/Scripts/Kingdom/Editor/SpriteSheetGenerator.cs`
  - `Assets/Editor/ComfyUI/ComfyUIAssetGenerator.cs`
  - 각 `.meta` 동반 삭제
- 부분 제거:
  - `Assets/Scripts/Kingdom/Editor/KingdomSpriteBindingTools.cs`
    - `[MenuItem("Tools/Kingdom/Sprites/Apply Sample Runtime Paths")]` 제거
    - `[MenuItem("Tools/Kingdom/Sprites/Migrate Barracks Soldier Config References")]` 제거
- 유지 메뉴(의도):
  - `Tools/Common/Scene Switcher`
  - `Tools/Common/AI Sprite Processor`
  - `Tools/Common/AI Sprite Processor - Run Preset Load Regression`
  - `Tools/Kingdom/Run * Regression` 6개
  - `Tools/Kingdom/Sprites/Validate Runtime Sprite Bindings`
  - `Tools/Kingdom/Sprites/Run Missing Hint Regression`
  - `Tools/Check Available Models`
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0
  - `Assets` 기준 `MenuItem("Tools/")` 재검색으로 잔여 메뉴 확인 완료

## [2026-02-22 20:48:27] 작업 기록
- 요청: 리그레이션 툴을 개발 전용 폴더로 이동
- 조치:
  - `Assets/Scripts/Kingdom/Editor/KingdomRegressionMenu.cs`
    - `Tools/Kingdom/Run ...` -> `Tools/Kingdom/Developer/Regression/Run ...` (6개)
  - `Assets/Scripts/Kingdom/Editor/AISpriteProcessor.cs`
    - `Tools/Common/AI Sprite Processor - Run Preset Load Regression`
      -> `Tools/Common/Developer/AI Sprite Processor/Run Preset Load Regression`
  - `Assets/Scripts/Kingdom/Editor/KingdomSpriteBindingTools.cs`
    - `Tools/Kingdom/Sprites/Run Missing Hint Regression`
      -> `Tools/Kingdom/Sprites/Developer/Run Missing Hint Regression`
- 검증:
  - `dotnet build Assembly-CSharp.csproj -v minimal` 오류 0

## [2026-02-22 20:58:05] 작업 기록
- 이슈: GameScene 시작 시 Hero sprite missing으로 중단됨
  - 로그: heroId=DefaultHero, action=idle/walk/attack/die, reason=ction record missing
  - 원인: Assets/Resources/Sprites/Heroes/manifest.json에 ctionGroup=multi만 존재하고, 런타임은 기존에 액션별 레코드만 인식
- 조치:
  - Assets/Scripts/Kingdom/App/GameScene.cs
    - TryResolveHeroActionFromManifest에서 multi 액션그룹을 액션 후보로 인식
    - multi 레코드 선택 시 텍스처의 스프라이트 이름에 액션 토큰(_idle_, _walk_, _attack_, _die_) 존재 여부 검증 추가
  - Assets/Scripts/Kingdom/Game/HeroController.cs
    - LoadGeneratedFramesFromManifest에서 multi 액션그룹 지원
    - multi 텍스처 로드시 현재 액션 라벨 기반 프레임만 필터링해서 사용
- 기대 효과:
  - AI Sprite Processor SmartSlice 4행 분리로 생성된 multi_*_Processed.png 단일 텍스처도 런타임 히어로 4액션으로 정상 재생
  - 액션 라벨 프레임이 없는 잘못된 multi 결과는 시작 전 검증 단계에서 명확히 탐지
- 검증:
  - dotnet build Assembly-CSharp.csproj -v minimal 오류 0 (기존 경고만 유지)

## [2026-02-22 21:06:39] 작업 기록
- 이슈1: 타워 클릭 시 SelectionInfoPanel 미노출
  - 원인: SelectionController가 설정된 LayerMask에서 Collider는 찾지만 ISelectableTarget을 못 찾는 케이스에서 재탐색을 하지 않아 Select(null)로 종료
  - 조치: Assets/Scripts/Kingdom/Game/UI/SelectionController.cs
    - FindClosestSelectable() 헬퍼 추가
    - 1차 탐색 실패 시 Physics2D.AllLayers로 동일 반경 재탐색 후 선택 처리

- 이슈2: 영웅 선택 시 현재 HP=0 표기, 월드 HP바가 빈 상태
  - 원인: HeroController가 _currentHp만 설정하고 _maxHp 동기화를 놓치는 경로가 있어 HpRatio 계산이 0으로 고정될 수 있음
  - 조치: Assets/Scripts/Kingdom/Game/HeroController.cs
    - Configure()/Respawn()에서 InitializeHealth(heroConfig.GetMaxHp(_level)) 사용
    - 레벨업 시 _maxHp 갱신 반영
    - 가드 힐 계산에서 _maxHp 기준 사용

- 검증:
  - dotnet build Assembly-CSharp.csproj -v minimal 오류 0 (기존 경고만 유지)

## [2026-02-22 21:09:32] 작업 기록
- 이슈: 타워 클릭 시 액션 메뉴는 열리지만 SelectionInfoPanel은 갱신되지 않음
- 원인:
  - Assets/Scripts/Kingdom/App/GameScene.cs의 타워 클릭 처리에서
    - 타워 액션 메뉴를 열고
    - 같은 프레임 SelectionController.SuppressSelectionForCurrentFrame()로 선택 입력을 억제
  - 결과적으로 SelectionController의 선택 이벤트가 발생하지 않아 패널 갱신 누락
- 조치:
  - Assets/Scripts/Kingdom/Game/TowerManager.cs
    - TryGetTowerSelectableTarget(int towerId, out ISelectableTarget) 추가
  - Assets/Scripts/Kingdom/App/GameScene.cs
    - 타워 클릭 분기에서 메뉴 오픈 직후 _selectionController.Select(towerTarget) 명시 호출
- 검증:
  - dotnet build Assembly-CSharp.csproj -v minimal 오류 0
